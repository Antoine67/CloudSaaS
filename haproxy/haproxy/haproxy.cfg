
defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

frontend http
    bind *:8090
    mode http
    timeout client 10s


    #Version controller
    acl VERSION_1_0 req.hdr(App-Version) -i "1.0"

    #Microservice 1
    acl PATH_products path_beg -i /api/products
    acl PATH_menus path_beg -i /api/menus

    #Microservice 2
    acl PATH_orders path_beg -i /api/orders
    acl PATH_deliveries path_beg -i /api/deliveries


    #Routing
    use_backend ms_products_menus if PATH_products VERSION_1_0
    use_backend ms_products_menus if PATH_menus VERSION_1_0
    use_backend ms_orders_deliveries if PATH_orders VERSION_1_0
    use_backend ms_orders_deliveries if PATH_deliveries VERSION_1_0

	#Additional stats
	stats enable
    stats uri /proxy-stats
    stats refresh 10s
    stats admin if LOCALHOST


backend ms_products_menus
	balance roundrobin 
    server s1 127.0.0.1:3001 check maxconn 100
	server s2 127.0.0.1:3002 check maxconn 100

backend ms_orders_deliveries
	balance roundrobin 
    server s1 127.0.0.1:3003 check maxconn 100
